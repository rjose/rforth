= Pass 13: Add a control loop

This moves the control loop out of assembly and into rforth

== Tasks
- [x] Add support for nested LOADs
- [x] Add control loop


== Status
- Effort spent: 3h
- Effort left: 0h
- Initial estimate: 3h

== Log


=== Saturday, 05/23/2015

----
** 12:19 >> Let's add support for nested Getc
We'll need to switch the buffer it reads from.

I think we need to have Getc work with pointers to buffers and
indexes. If we can do this, it should be easy to move to different
buffers.

** 15:34 Finished rewriting Getc to use pointers for buffers and indexes
Now, we need a mechanism to switch between buffers. We need to have an
array of:

    .num_chars_read
    .buf_index
    buffer

so we can just set an index to swap between them. Let's take a break
and then spec this out.

** 16:25 Alright, I have something spec'd out

** 16:33 >> Let's implement this

** 16:54 (21 min) Implemented PushBufferSet
Let's quickly implement PopBufferSet

** 17:00 << (27 min) Implemented PopBufferSet
Alright, let's take a break. After that, we'll give this a try.

** 17:02 Oh, I could just increment the pointers when doing the push
Let's do that afterwards.

** 21:07 >> Update buffer set pointers by advancing instead of computing

** 21:13 (6 min) Done re-implementing push buffer set
Let's try pushing and popping state.

** 21:21 (14 min) Got a segfault
The num_chars_read_p looks good. I wonder if it's our buffer_p pointer.

** 21:29 << (23 min) Hmmm...looks like we never get to popping the buffer sets

** 22:27 Calling Interpret from WLoad seems to cause a problem

** 23:22 Almost got this running
Need to check that we're popping the buffer sets properly

** 23:57 One bug I'm chasing
After a LOAD, we stop. I think it has something to do with EOF not
being reset...Yup that was it.
----


=== Sunday, 05/24/2015
----
** 07:39 We need to add a control loop next
Let's call this REPL

** 07:44 Done stubbing out the REPL word
Let's create an INTERPRET word next. Oh, actually I'm going to define
the REPL word in rforth. Let's remove the assembler version.

** 07:52 Defined WInterpret instead

** 07:54 Actually, I could use Interpret directly as the function for INTERPRET

** 07:59 Let's set up a main.fth file and run it from STDIN

** 17:06 We can load main.fth
For simple expressions, it works fine. Calling INTERPRET generates a
segfault though.

** 17:27 Hmmm...it looks like our while loop test is flawed
We're executing the value of 1 as an entry instead of as the result of
a test. I guess I need to define a word called TRUE that pushes 1 onto
stack. 

** 17:32 Yup, I defined a TRUE word that returned 1
This worked for my REPL loop.

** 21:40 Hmmm...I think I need to rethink Interpret

** 21:49 Actually, I found another way around this
I basically take the last entry that was created and execute it. I may
still need to rethink Interpret, but not today :-)
----